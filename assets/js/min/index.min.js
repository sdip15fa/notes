var usernotes,edittimeout,__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function fulfilled(e){try{step(o.next(e))}catch(e){i(e)}}function rejected(e){try{step(o.throw(e))}catch(e){i(e)}}function step(e){e.done?a(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((o=o.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,o,a,i,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function verb(i){return function(l){return function step(i){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,o&&(a=2&i[0]?o.return:i[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(a=c.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){c.label=i[1];break}if(6===i[0]&&c.label<a[1]){c.label=a[1],a=i;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(i);break}a[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},r=!1,id=localStorage.id,url="https://api-notes.wcyat.me",alerthtml=document.getElementById("alert");function sleep(e){return new Promise((function(t){return setTimeout(t,e)}))}function link(){var e=document.createElement("p");e.id="link",e.innerHTML='Share this note by url: <a href="'.concat(window.location.href.split("?")[0],"?id=").concat(id,'">').concat(window.location.href.split("?")[0],"?id=").concat(id,"</a>"),document.getElementById("root").appendChild(e)}function alertmessage(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(o){switch(o.label){case 0:return(n=alerthtml).innerHTML=t,n.className=e,document.body.insertBefore(n,document.querySelector("h1").nextSibling),[4,sleep(5e3)];case 1:return o.sent(),document.getElementById("alert").remove(),localStorage.alerted=!0,[2]}}))}))}function newnote(e){return __awaiter(this,void 0,void 0,(function(){var t,n;return __generator(this,(function(o){for(t=1;null!==tinymce.get("".concat(t));t++);return(n=document.createElement("div")).innerHTML='<br><textarea id="'.concat(t,'" rows="10" name="note">').concat(e,"</textarea>\n</div>"),document.getElementById("root").insertBefore(n,document.getElementById("btn")),tinymce.init({selector:"textarea",init_instance_callback:function(e){e.on("Paste Change input Undo Redo",(function(){clearTimeout(edittimeout),edittimeout=setTimeout((function(){usercreate(e.id)}),500)}))}}),[2]}))}))}function logout(){delete localStorage.k,delete localStorage.username,localStorage.alerted&&delete localStorage.alerted,window.location.replace("".concat(window.location.href.split("?")[0],"?logout=successful"))}function getvar(e){for(var t=0,n=window.location.search.substring(1).split("&");t<n.length;t++){var o=n[t].split("=");if(o[0]===e)return o[1]}return""}function usercreate(e){usernotes||(usernotes={key:localStorage.k}),usernotes[e]=tinymce.get(e).getContent(),axios.post("".concat(url,"/notes/users/").concat(localStorage.k),usernotes).then((function(e){console.log(e.data)})).catch((function(){alertmessage("alert alert-danger","404 not found")}))}function anon(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,getvar("id")];case 1:return e.sent()?[4,getvar("id")]:[3,3];case 2:id=e.sent(),localStorage.id=id,e.label=3;case 3:return void 0!==id?[3,5]:[4,axios.get("https://notes.wcyat.me/idgenerator").then((function(e){id=e.data,localStorage.id=id}))];case 4:return e.sent(),[3,7];case 5:return[4,axios.get("".concat(url,"/get/").concat(id)).then((function(e){tinymce.get("note").setContent(e.data.text)}))];case 6:e.sent(),link(),e.label=7;case 7:return r=!0,[2]}}))}))}function createnote(e){var t={id:id,text:e};axios.post("".concat(url,"/create"),t).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),null===document.getElementById("link")&&link()}function testserver(e){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t=!1,[4,axios.get("".concat(e,"/testconnection")).then((function(){t=!0})).catch((function(){}))];case 1:return n.sent(),[2,t]}}))}))}function init(){return __awaiter(this,void 0,void 0,(function(){var e,t,n,o;return __generator(this,(function(a){switch(a.label){case 0:e=0,t=["https://api-notes.wcyat.me","https://notes-server.wcyat.me","https://api.notes.wcyat.me"],a.label=1;case 1:return e<t.length?[4,testserver(n=t[e])]:[3,4];case 2:if(a.sent())return url=n,[3,4];a.label=3;case 3:return e++,[3,1];case 4:return(getvar("signedin")||getvar("signup")||getvar("signin")||getvar("logout"))&&(localStorage.alerted?window.location.replace(window.location.href.split("?")[0]):alertmessage(getvar("signedin")?"alert alert-warning":"alert alert-success",getvar("signedin")?"You are already signed in as ".concat(localStorage.username,"."):getvar("logout")?"Successfully logged out.":"Successfully signed ".concat(getvar("signup")?"up":"in"," as ").concat(localStorage.username,"."))),localStorage.username&&localStorage.k?(document.getElementById("header").innerHTML='<button\n    style="margin-top: 10px; margin-right: 10px"\n    class="btn btn-secondary float-end"\n    onclick="logout()"\n  >\n    Log out\n  </button>',document.getElementById("note").remove(),tinymce.EditorManager.execCommand("mceRemoveEditor",!0,"note"),(o=document.createElement("div")).className="delta",o.id="btn",o.innerHTML="<button class=\"btn btn-primary\" onclick=newnote('')>Create</button>",document.getElementById("root").appendChild(o),axios.get("".concat(url,"/notes/users/").concat(localStorage.k)).then((function(e){for(var t in e.data)newnote(e.data[t]);(usernotes=e.data).key=localStorage.k}))):anon(),[2]}}))}))}init();